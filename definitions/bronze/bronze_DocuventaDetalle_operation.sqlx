config {
  type: "operations",
  description: "Exporta la tabla bronze.DocuVentaDetalle a GCS en formato Parquet, particionado por fecha (d√≠a anterior).",
  dependencies: ["bronze_DocuVentaDetalle"]
}

EXPORT DATA OPTIONS(
    uri = CONCAT(
  'gs://bucket_dmc_grupo04/bronze/sql/DocuVentaDetalle/',
  FORMAT_DATE('%Y/%m/%d', DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY)),
  '/docuventa_detalle_',
  FORMAT_DATE('%Y%m%d', DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY)),
  '_*.parquet'),
  format='PARQUET',
  overwrite=true
) AS
SELECT *
FROM proyectointegrador-grupo04.bronze.bronze_DocuVentaDetalle
where date(FechaCreacion) = date_sub(current_date(), interval 1 day)
     or date(FechaModificacion) = date_sub(current_date(), interval 1 day);